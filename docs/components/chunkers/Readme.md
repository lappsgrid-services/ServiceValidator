# Chunkers

Consistency checking on all taggers used on http://galaxy.lappsgrid.org/ and http://jetstream.lappsgrid.org/. This was done in a way similar to the [splitters](../splitters) but reported on in a less verbose way.

## Summary of Observations

Below is a table with observations on four chunker services. See further down for more verbose observations.

service                 | requires    | produces  | other
---                     | ---         | ---       | ---
v gate.npchunker_2.2.0  | 1, 2        | &check;   | 3, 4
v gate.npchunker_2.3.0  | 1, 2        | &check;   | 3, 4
v gate.vpchunker_2.2.0  | 2, 5        | &check;   | 4, 6
v gate.vpchunker_2.3.0  | 2, 5        | &check;   | 4, 6

The `requires` column indicates whether tool requirements from metadata match its behavior when given input whereas the `produces` column indicates whether what the tool produces matches what is specified in the metadata. Any other observations are in the `other` column. Check marks indicate all is well, the numbers refer to elements from the list below.

1. Service requirement says Token and Token#pos, but it appears to require Sentence and Token
2. Service requirement says xml#gate but will try to run on text and LIF input (and then fails because it cannot find sentences)
3. Running it on GATE input with sentences and tokens gives you a null pointer exception
4. Running it on GATE input with just sentences just copies the input (while loosing the view identifier and the `@language` attribute)
5. Service requirement says xml#gate but will try to run on text and LIF input (and then proceeds to produce output with an empty view)
6. No VerbChunks are added

GATE chunkers use `gate` as the type in the metadata if they add a view.

One question is whether the service requirement should not just be `xml#gate` since the requirements are not easily enforced anyway and currently the only pointers we get are error message generated by the GATE chunkers themselves. We could have two kinds of GATE services for the exact same GATE tool: those wrapped as services that take and produce GATE documents as their payload and those that work with LIF.


## Rounding up the Services

Taken from https://github.com/lappsgrid-incubator/GalaxyMods/blob/master/config/tool_conf.xml and its sister in the develop branch, with the invokers lifted from the Galaxy XML wrappers.

```
gate/gate.npchunker_2.2.0.xml
gate/gate.npchunker_2.3.0.xml
  gate/invoke.lsd gate.npchunker_2.2.0
  gate//invoke.lsd gate.vpchunker_2.2.0

gate/gate.vpchunker_2.2.0.xml
gate/gate.vpchunker_2.3.0.xml
  gate/invoke.lsd gate.npchunker_2.3.0
  gate//invoke.lsd gate.vpchunker_2.3.0
```

## Service Metadata

Service metadata from http://api.lappsgrid.org/:

service                 | requires                    | produces
---                     | ---                         | ---
v gate.npchunker_2.2.0  | xml#gate, Token, Token#pos  | xml#gate, NounChunk
v gate.npchunker_2.3.0  | xml#gate, Token, Token#pos  | xml#gate, NounChunk
v gate.vpchunker_2.2.0  | xml#gate, Token, Token#pos  | xml#gate, VerbChunk
v gate.vpchunker_2.3.0  | xml#gate, Token, Token#pos  | xml#gate, VerbChunk

Well, actually, the API was having another "502 Bad Gateway" hissy fit so instead I used the LSD script [metadata.lsd](../metadata.lsd) (which is geared towards accessing services on the Vassar server) followed by a Python pretty print, for example:

```
$ lsd metadata.lsd gate.vpchunker_2.3.0 | python -m json.tool
```


## Service behavior analysis

The invokers and the service names were already listed above. We use the same input as for the splitters and tokenizers except that we add a few input files with Token and Sentence annotations since so many services claim they require those. And we again create output using a [bash script](chunkers.sh).

Here are observations for the tested chunkers as of January 25th 2018, service output is stored in the [output directory](output).

gate/gate.npchunker_2.2.0.xml

- Service requirement says Token and Token#pos, but it appears to require Sentence and Token
- Service requirement says xml#gate but will try to run on text and LIF input (and then fails because it cannot find sentences)
- Running it on GATE input with sentences and tokens gives you a null pointer exception
- Running it on GATE input with just sentences just copies the input (while loosing the view identifier and the `@language` attribute)

gate/gate.npchunker_2.3.0.xml

- Same observations as for version 2.2.0, except that the null pointer exception is more verbose

gate/gate.vpchunker_2.2.0.xml

- Service requirement says xml#gate but will try to run on text and LIF input (and then proceeds to produce output with an empty view)
- Service requirement says Token and Token#pos, but it appears to require Sentence and Token, and requirements are not enforced
- Running it on GATE input with just sentences just copies the input (while loosing the view identifier and the `@language` attribute)
- No VerbChunks are added

gate/gate.vpchunker_2.3.0.xml

- Same observations as for version 2.2.0
